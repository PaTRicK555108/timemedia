<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Watermark Tool</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center; 
      height: 100vh; 
      margin: 0; 
      background-color: #007bff; 
      color: white; 
    }
    canvas { display: none; }
    input, select, button { 
      margin: 10px 5px; 
      padding: 10px; 
      border: none; 
      border-radius: 5px; 
      font-size: 16px;
    }
    button { 
      background-color: white; 
      color: #007bff; 
      cursor: pointer; 
    }
    button:hover {
      background-color: #0056b3; 
      color: white;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
  </style>
</head>
<body>
  <h2>Upload Images to Add Watermark</h2>
  <input type="file" id="imageInput" accept="image/*" multiple>
  
  <div class="controls">
    <label>Position:</label>
    <select id="positionSelect">
      <option value="bottom-right">Bottom Right</option>
      <option value="bottom-left">Bottom Left</option>
      <option value="top-right">Top Right</option>
      <option value="top-left">Top Left</option>
      <option value="center">Center</option>
    </select>
    
    <label>Offset X:</label>
    <input type="number" id="offsetX" value="10" min="0">

    <label>Offset Y:</label>
    <input type="number" id="offsetY" value="10" min="0">
  </div>

  <button onclick="downloadImages()">Download Watermarked Images</button>
  <canvas id="imageCanvas"></canvas>

  <script>
    const imageInput = document.getElementById('imageInput');
    const positionSelect = document.getElementById('positionSelect');
    const offsetXInput = document.getElementById('offsetX');
    const offsetYInput = document.getElementById('offsetY');
    const canvas = document.getElementById('imageCanvas');
    const ctx = canvas.getContext('2d');

    function loadImage(src) {
      return new Promise((resolve) => {
        const img = new Image();
        img.crossOrigin = "anonymous"; 
        img.onload = () => resolve(img);
        img.src = src;
      });
    }

    async function drawAndDownload(image, logo, filename) {
      canvas.width = image.width;
      canvas.height = image.height;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(image, 0, 0);

      const logoWidth = image.width * 0.2;
      const logoHeight = (logo.height / logo.width) * logoWidth;

      let x, y;
      const position = positionSelect.value;
      const offsetX = parseInt(offsetXInput.value);
      const offsetY = parseInt(offsetYInput.value);

      switch (position) {
        case 'bottom-right':
          x = image.width - logoWidth - offsetX;
          y = image.height - logoHeight - offsetY;
          break;
        case 'bottom-left':
          x = offsetX;
          y = image.height - logoHeight - offsetY;
          break;
        case 'top-right':
          x = image.width - logoWidth - offsetX;
          y = offsetY;
          break;
        case 'top-left':
          x = offsetX;
          y = offsetY;
          break;
        case 'center':
          x = (image.width - logoWidth) / 2 + offsetX;
          y = (image.height - logoHeight) / 2 + offsetY;
          break;
      }

      ctx.drawImage(logo, x, y, logoWidth, logoHeight);

      const link = document.createElement('a');
      link.download = filename;
      link.href = canvas.toDataURL("image/png");
      link.click();
    }

    async function downloadImages() {
      const files = imageInput.files;
      if (!files.length) return;

      const logo = await loadImage('timemedia.png'); 

      for (const file of files) {
        const originalFilename = file.name.replace(/\.[^/.]+$/, '');
        const image = await loadImage(URL.createObjectURL(file));
        await drawAndDownload(image, logo, `${originalFilename}_TimeMedia.png`);
      }
    }
  </script>
</body>
</html>